<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Docker on Windows 2016; Container Introspection via Docker Daemon / API - i-py.com</title><link rel="icon" type="image/png" href=icons/myicon.png /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Docker on Windows 2016; Container Introspection via Docker Daemon / API" />
<meta property="og:description" content="So with the RTM of Windows Server 2016, with it comes official support for docker; and with that - containers. Awesome. In this post, we&rsquo;ll talk about container introspection, via the Docker Daemon / API. First and foremost, I&rsquo;m not going to get into the nitty gritty of installing and configuring docker." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://i-py.com/posts/2016-10-14-docker-introspection-api-windows/" />
<meta property="article:published_time" content="2016-10-14T12:32:30-05:00" />
<meta property="article:modified_time" content="2016-10-14T12:32:30-05:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Docker on Windows 2016; Container Introspection via Docker Daemon / API"/>
<meta name="twitter:description" content="So with the RTM of Windows Server 2016, with it comes official support for docker; and with that - containers. Awesome. In this post, we&rsquo;ll talk about container introspection, via the Docker Daemon / API. First and foremost, I&rsquo;m not going to get into the nitty gritty of installing and configuring docker."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://i-py.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://i-py.com/css/main.css" />
	<link rel="stylesheet" type="text/css" href="https://i-py.com/css/custom.css" />
	

	
	<script src="https://i-py.com/js/main.js"></script>
	<script src="https://i-py.com/js/abc.js"></script>
	<script src="https://i-py.com/js/xyz.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<base href="https://i-py.com/">
	<h1 class="site-title"><a href="https://i-py.com/">i-py.com</a></h1>
	<div class="site-description"><h2>Technical Blog of Francis Setash</h2><nav class="nav social">
			<ul class="flat"></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">Docker on Windows 2016; Container Introspection via Docker Daemon / API</h1>
			<div class="meta">Posted on &mdash; Oct 14, 2016</div>
		</div>

		<div class="markdown">
			<p>So with the RTM of Windows Server 2016, with it comes official support for docker; and with that - containers. Awesome. In this post, we&rsquo;ll talk about container introspection, via the Docker Daemon / API. First and foremost, I&rsquo;m not going to get into the nitty gritty of installing and configuring docker.</p>
<p><a href="https://msdn.microsoft.com/en-us/virtualization/windowscontainers/quick_start/quick_start_windows_server">Microsoft/Docker have done a decent job of that already</a>. So, what we are going to talk about is setting up the Docker daemon to allow us to do some introspection from within a container. <strong>NOTE:</strong> This is not a hardened solution; this is just a lab environment configuration; you would want to enable TLS and ensure your ACLs/firewall are configured correctly in practice. So lets talk about getting the daemon running and listening. It&rsquo;s pretty simple, but not readily obvious or particularly well documented <em>for Windows</em>. We&rsquo;re doing to need to take a few steps beyond the basic Docker install to get the Daemon responding.</p>
<ol>
<li>
<p>Open the firewall on the docker host.</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">netsh advfirewall firewall add rule name=&#34;Docker daemon API&#34; dir=in action=allow protocol=TCP localport=2375
</code></pre></div></li>
<li>
<p>Configure the file at C:\programdata\docker\config\daemon.json (this did not exist by default on my installation)</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#b58900">new-item</span> -Type File c:\ProgramData\docker\config\daemon.json
</code></pre></div></li>
<li>
<p>Edit the contents of daemon.json to:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">{ &#34;hosts&#34;: [&#34;tcp://0.0.0.0:2375&#34;, &#34;npipe://&#34;] }
</code></pre></div><p>This causes the daemon to listen on all IP addresses; both externally facing, and internally facing for container networking.</p>
</li>
<li>
<p>Restart Docker</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">Restart-Service docker
</code></pre></div></li>
</ol>
<p>Cool. Now what do we do with it? Let&rsquo;s look at the <a href="https://docs.docker.com/engine/reference/api/docker_remote_api_v1.24/">Docker API documentation.</a> Hm. Ok. So, from within a docker container, to learn about itself, we&rsquo;ll run:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#268bd2">$containerInfo</span> = <span style="color:#b58900">Invoke-WebRequest</span> 1.2.3.4:2375/containers/HEXCONTAINERIDHERE/json -UseBasicParsing | <span style="color:#b58900">ConvertFrom-Json</span>
<span style="color:#586e75">#Note: 1.2.3.4 would be the gateway IP address of the Container; note there is an internal virtual network and you must use the internal interface of the docker host</span>
<span style="color:#586e75">#In this example you can just run _ipconfig_ and look at the gateway; use that.</span>
</code></pre></div><p>Let&rsquo;s see what we have here:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">Id              : 7729e5f666261517c3f7da4c5951c61a1b80178dd0da4517d37069879bcda01f
Names           : {/tiny_mirzakhani}
Image           : microsoft/iis
ImageID         : sha256:6e30590a2139185500136f0051a36d7b390e649a96dc51d3a3477eff08d69fbd
Command         : C:\ServiceMonitor.exe w3svc
Created         : 1476365755
Ports           : {}
Labels          :
State           : running
Status          : Up 56 minutes
HostConfig      : @{NetworkMode=default}
NetworkSettings : @{Networks=}
Mounts          : {}
</code></pre></div><p>Awesome. If I had exposed ports; I&rsquo;d be able to see which here. If I needed to know the Image it was running, it would also be here. This is a short post, but it&rsquo;s here because the documentation on getting / using the API is pretty much non-existent for Windows Server 2016 and it&rsquo;s really handy stuff. Stay tuned for getting this running in tandem with a Flask app for automation.</p>
		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/tags/docker">docker</a></li>
								
								<li><a href="/tags/windows">windows</a></li>
								
							</ul>
					</nav>
				
			
		</div>
		</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> All Content Copyright © - Francis Setash   </div>
	</nav>
</div>




</body>
</html>
